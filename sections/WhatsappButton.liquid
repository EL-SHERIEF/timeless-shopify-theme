<div id="wa-btn-wrapper" class="fixed right-2 sm:right-4 bottom-4 flex items-center z-10" dir="rtl">
  <!-- WhatsApp Icon -->
  <div id="wa-icon" class="rounded-full bg-[#00FF1E] p-4 text-black flex items-center justify-center cursor-pointer"
       onmouseenter="document.getElementById('wa-input-container').classList.remove('hidden'); document.getElementById('wa-input-container').classList.add('flex');"
       onmouseleave="if(document.getElementById('wa-message').value.trim()==='') { document.getElementById('wa-input-container').classList.remove('flex'); document.getElementById('wa-input-container').classList.add('hidden'); }">
    <!-- Inline WhatsApp SVG icon -->
    <svg width="30" height="30" viewBox="0 0 473 490" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- SVG Path -->
    </svg>
  </div>

  <!-- Message Input and Send Button -->
  <div id="wa-input-container" class="hidden flex items-center gap-3 transition-opacity duration-150 ps-4"
       onmouseenter="this.classList.remove('hidden'); this.classList.add('flex');"
       onmouseleave="if(document.getElementById('wa-message').value.trim()==='') { this.classList.remove('flex'); this.classList.add('hidden'); }">
    <textarea id="wa-message" class="bg-[#2A3942] text-white placeholder-[#7E8F98] p-[10px] sm:px-[20px] px-[10px] resize-none max-h-[45px] rounded-xl outline-none ring-8 ring-[#202C33] w-64 transition-all duration-500"
              placeholder="{{ settings.whatsapp_placeholder }}"></textarea>
    <a id="wa-send" href="{{ settings.wa_link }}" target="_blank" class="rounded-2xl bg-[#202C33] p-[17px] flex items-center justify-center hover:bg-[#2A3942]">
      <svg width="28" height="28" class="duration-150" viewBox="0 0 254 234" fill="none" xmlns="http://www.w3.org/2000/svg">
        <!-- SVG Path -->
      </svg>
    </a>
  </div>
</div>

{% schema %}
{
  "name": "WhatsApp Button",
  "settings": [
    {
      "type": "text",
      "id": "wa_link",
      "label": "WhatsApp Link (wa.me URL)",
      "default": "https://wa.me/1234567890"
    },
    {
      "type": "text",
      "id": "whatsapp_placeholder",
      "label": "Placeholder Text",
      "default": "Type your message here..."
    }
  ]
}
{% endschema %}

<script>
  (function(){
    var waMessage = document.getElementById('wa-message');
    var waSend = document.getElementById('wa-send');
    waMessage.addEventListener('input', function(){
      var encodedMessage = encodeURIComponent(waMessage.value);
      // Using JSON filter to output the link as a valid string
      var baseLink = {{ settings.wa_link }};
      waSend.href = baseLink + "?text=" + encodedMessage;
    });
  })();
</script>
