{%- liquid
  if section.settings.filters_position == 'left'
    assign sidebar_enabled = true
  else
    assign sidebar_enabled = false
  endif
-%}

{%- unless section.settings.hide_heading -%}
  <header class="rte {{ section.settings.tailwind | default: 'max-w-screen-sm' }}">
    <h1>{{ collection.title }}</h1>
    {{ collection.description }}
  </header>
{%- endunless -%}

{%- if collection.products_count > 0 -%}
  <div class="flex flex-col items-start {% if sidebar_enabled %}md:flex-row{% endif %} gap-8 min-w-0">
    {%- if section.settings.filters_enabled -%}
      <aside class="
        bg-canvas-subdued pt-2 <sm:full-width
        {% if sidebar_enabled %}w-full md:basis-[300px] p-4 self-start md:sticky-below-header [--offset:.5rem]
        {% else %}p-6 <md:px-4
        {% endif %}
      ">
        <h2 class="technical text-sm -mt-4 {% if sidebar_enabled %}mb-3{% else %}mb-2{% endif %}">Filters</h2>
        {% render 'filters'
          results: collection
          stacked: sidebar_enabled
          opened: section.settings.opened_by_default
        %}
      </aside>
    {%- endif -%}

    <div class="grid gap-6">
      {%- liquid
        if section.settings.sorting_enabled
          render 'sort-by'
        endif
      -%}

      {% paginate collection.products by section.settings.page_size %}
        {% render 'product-grid'
          products: collection.products
          size: section.settings.grid_item_size
        %}

        {%- if paginate.pages > 1 -%}
          <nav class="pagination">{{ paginate | default_pagination }}</nav>
        {%- endif -%}
      {% endpaginate %}
    </div>
  </div>

{%- else -%}
  <p class="text-ink-subdued text-center">No products in this collection</p>

{%- endif -%}

{% schema %}
{
  "name": "Collection",
  "tag": "section",
  "class": "section grid gap-12",
  "settings": [
    {
      "type": "header",
      "content": "Heading"
    },
    {
      "type": "checkbox",
      "id": "hide_heading",
      "label": "Hide heading",
      "default": false
    },
    {
      "type": "liquid",
      "id": "tailwind",
      "label": "Tailwind classes",
      "info": "Default: \"max-w-screen-sm\""
    },
    {
      "type": "header",
      "content": "Sorting and filters"
    },
    {
      "type": "checkbox",
      "id": "sorting_enabled",
      "label": "Enable sorting",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "filters_enabled",
      "label": "Enable filters",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "opened_by_default",
      "label": "Opened by default",
      "default": true
    },
    {
      "type": "select",
      "id": "filters_position",
      "label": "Position",
      "options": [
        {
          "value": "top",
          "label": "top"
        },
        {
          "value": "left",
          "label": "left"
        }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Products"
    },
    {
      "type": "range",
      "id": "grid_item_size",
      "label": "Grid item size",
      "unit": "px",
      "min": 100,
      "max": 350,
      "step": 10,
      "default": 180
    },
    {
      "type": "number",
      "id": "page_size",
      "label": "Products per page",
      "default": 12
    }
  ],
  "blocks": [
    {
      "type": "sale-badge",
      "name": "Sale badge settings",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "enabled",
          "label": "Show sale badge",
          "default": true
        },
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "On sale"
        },
        {
          "type": "liquid",
          "id": "tailwind",
          "label": "Tailwind classes",
          "info": "Default: \"right-0 bottom-4\""
        }
      ]
    }
  ]
}
{% endschema %}
