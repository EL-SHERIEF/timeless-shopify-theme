{% schema %}
{
  "name": "Before After Slider",
  "settings": [
    {
      "type": "image_picker",
      "id": "before_image",
      "label": "Before Image"
    },
    {
      "type": "image_picker",
      "id": "after_image",
      "label": "After Image"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Achieve long-lasting results effortlessly"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Get smooth skin without the hassle of daily shaving or salon appointments. In just a few weeks, youâ€™ll enjoy long-lasting results. A simple solution for beauty that lasts."
    }
  ],
  "presets": [
    {
      "name": "Before After Slider",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<div class="segmastyle before-after-section section section-blends section-full">
  <div class="flex flex-col md:flex-row items-center gap-8 max-w-5xl mx-auto px-4 pt-5">
    <!-- Image Comparison Slider -->
    <section class="image-comparison w-full md:w-1/2" data-component="image-comparison-slider">
      <div class="image-comparison__slider-wrapper">
        <!-- Slider Input -->
        <input type="range" min="0" max="100" value="50" class="image-comparison__range" id="image-comparison-range" aria-label="Image comparison slider">

        <!-- After Image -->
        <div class="image-comparison__image-wrapper">
          <figure class="image-comparison__figure">
            <picture class="image-comparison__picture">
              {% if section.settings.after_image %}
                <img src="{{ section.settings.after_image | img_url: 'master' }}" alt="After Image" class="image-comparison__image">
              {% else %}
                <p>Upload an After Image</p>
              {% endif %}
            </picture>
            <figcaption class="image-comparison__caption image-comparison__caption--after" style="opacity: 1;">
              <span class="image-comparison__caption-body">After</span>
            </figcaption>
          </figure>
        </div>

        <!-- Before Image (Overlay) -->
        <div class="image-comparison__image-wrapper image-comparison__image-wrapper--overlay">
          <figure class="image-comparison__figure">
            <picture class="image-comparison__picture">
              {% if section.settings.before_image %}
                <img src="{{ section.settings.before_image | img_url: 'master' }}" alt="Before Image" class="image-comparison__image image-comparison__image--before" style="clip-path: inset(0 50% 0 0);">
              {% else %}
                <p>Upload a Before Image</p>
              {% endif %}
            </picture>
            <figcaption class="image-comparison__caption image-comparison__caption--before" style="opacity: 1;">
              <span class="image-comparison__caption-body">Before</span>
            </figcaption>
          </figure>
        </div>

        <!-- Slider Thumb -->
        <div class="image-comparison__slider" style="left: 50%;">
          <span class="image-comparison__thumb"></span>
        </div>
      </div>
    </section>

    <!-- Text Section -->
    <div class="w-full md:w-1/2 text-center md:text-left">
      <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4">{{ section.settings.heading }}</h2>
      <p class="font-medium text-gray-800 mb-4">{{ section.settings.description }}</p>
    </div>
  </div>

  <style>
    :root {
      --brand-blue-core: #0091DF;
      --base-light: #fff;
      --base-dark: #000;
    }



    .segmastyle .image-comparison {
      border-radius:15px;overflow:hidden;
      max-width: 768px;
      margin: 0 auto;
    }

    .segmastyle .image-comparison__slider-wrapper {
      position: relative;
      width: 100%;
      height: 0;
      padding-bottom: 100%; /* Maintains square aspect ratio */
      overflow: hidden;
    }

    .segmastyle .image-comparison__image-wrapper {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .segmastyle .image-comparison__figure {
      position: relative;
      margin: 0;
      width: 100%;
      height: 100%;
    }

    .segmastyle .image-comparison__image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .segmastyle .image-comparison__image--before {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      clip-path: inset(0 50% 0 0);
      transition: clip-path 0.05s ease-in-out;
    }

    .segmastyle .image-comparison__caption {
      position: absolute;
      bottom: 12px;
      color: var(--base-light);
      font-weight: bold;
      text-transform: uppercase;
      transition: opacity 0.2s ease-in-out;
      opacity: 1;
    }

    .segmastyle .image-comparison__caption--before {
      left: 12px;
      z-index: 3;
    }

    .segmastyle .image-comparison__caption--after {
      right: 12px;
      text-align: right;
    }

    .segmastyle .image-comparison__caption-body {
      border-radius:15px;
      background-color: rgba(0, 0, 0, 0.55);
      padding: 6px 12px;
      font-size: 1.2em;
    }

    .segmastyle .image-comparison__slider {
      position: absolute;
      top: 0;
      left: 50%;
      width: 2px;
      height: 100%;
      background-color: var(--base-light);
      z-index: 4;
      transition: left 0.05s ease-in-out;
    }

    .segmastyle .image-comparison__thumb {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 40px;
      height: 40px;
      background-color: var(--brand-blue-core);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .segmastyle .image-comparison__range {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      opacity: 0;
      cursor: ew-resize;
      z-index: 5;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .segmastyle .flex {
        flex-direction: column;
      }

      .segmastyle .image-comparison {
        width: 100%;
      }

      .segmastyle .image-comparison__caption-body {
        font-size: 0.9em;
      }

      .segmastyle .text-2xl {
        font-size: 1.5rem;
      }

      .segmastyle .text-3xl {
        font-size: 2rem;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const rangeInput = document.querySelector('.segmastyle .image-comparison__range');
      const beforeImage = document.querySelector('.segmastyle .image-comparison__image--before');
      const slider = document.querySelector('.segmastyle .image-comparison__slider');
      const beforeLabel = document.querySelector('.segmastyle .image-comparison__caption--before');
      const afterLabel = document.querySelector('.segmastyle .image-comparison__caption--after');

      function updateSlider(value) {
        const percentage = parseInt(value);
        beforeImage.style.clipPath = `inset(0 ${100 - percentage}% 0 0)`;
        slider.style.left = `${value}%`;

        // Dynamic label visibility based on slider position
        if (percentage > 50) {
          beforeLabel.style.opacity = '1';
          afterLabel.style.opacity = '0';
        } else if (percentage === 50) {
          beforeLabel.style.opacity = '1';
          afterLabel.style.opacity = '1';
        } else {
          beforeLabel.style.opacity = '0';
          afterLabel.style.opacity = '1';
        }
      }

      // Initialize slider position
      updateSlider(rangeInput.value);

      // Update slider on input
      rangeInput.addEventListener('input', function () {
        updateSlider(this.value);
      });
    });
  </script>
</div>